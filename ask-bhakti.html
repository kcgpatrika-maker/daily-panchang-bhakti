<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>Ask Bhakti — Bhakti Panchang</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .btn { margin: 4px; padding: 8px 12px; cursor: pointer; }
    .section { margin: 16px 0; }
    .hidden { display: none; }
    h2 { margin: 8px 0; }
    p { margin: 4px 0; }
  </style>
</head>
<body>

  <h1>देवी-देवता से पूछें</h1>

  <!-- देवता buttons -->
  <div id="devta-buttons"></div>

  <!-- Loading -->
  <p id="loading" class="hidden">लोड हो रहा है...</p>

  <!-- Error -->
  <p id="error" class="hidden"></p>

  <!-- Bhakti content -->
  <div id="content" class="hidden">
    <h2 id="name"></h2>

    <div id="mantra" class="section"></div>
    <div id="aarti" class="section"></div>
    <div id="pujaVidhi" class="section"></div>
    <div id="chalisa" class="section"></div>
    <div id="stotra" class="section"></div>
  </div>

<script>
const DEVTA_LIST = [
  { key: "hanuman", label: "हनुमान जी" },
  { key: "shiv", label: "शिव जी" },
  { key: "durga", label: "माँ दुर्गा" },
  { key: "krishna", label: "श्री कृष्ण" },
  { key: "ganesh", label: "गणेश जी" }
];

const backend = ""; // same domain, या backend URL डालें

function hide(el) { el.classList.add("hidden"); }
function show(el) { el.classList.remove("hidden"); }

function initButtons() {
  const container = document.getElementById("devta-buttons");
  DEVTA_LIST.forEach(d => {
    const btn = document.createElement("button");
    btn.textContent = d.label;
    btn.className = "btn";
    btn.onclick = () => fetchData(d.key);
    container.appendChild(btn);
  });
}

async function fetchData(devta) {
  hide(document.getElementById("error"));
  show(document.getElementById("loading"));
  hide(document.getElementById("content"));

  try {
    const res = await fetch(`${backend}/api/ask-bhakti?deity=${encodeURIComponent(devta)}`);
    const json = await res.json();

    if (!json || !json.content) throw new Error("Data not found");

    renderContent(json);
  } catch (e) {
    document.getElementById("error").textContent = "जानकारी लोड नहीं हो पाई";
    show(document.getElementById("error"));
  } finally {
    hide(document.getElementById("loading"));
  }
}

function renderContent(d) {
  document.getElementById("name").textContent = d.deity || "";

  fillSection("mantra", "मंत्र", d.content.mantra);
  fillAartiSection("aarti", "आरती", d.content.aarti);
  fillSection("pujaVidhi", "पूजा विधि", d.content.poojaVidhi ? [d.content.poojaVidhi] : []);
  fillSection("chalisa", "चालीसा", d.content.chalisa ? [d.content.chalisa] : []);
  fillSection("stotra", "स्तोत्र", d.content.stotra);

  show(document.getElementById("content"));
}

function fillSection(id, title, arr) {
  const sec = document.getElementById(id);
  sec.innerHTML = "";
  if (!arr || !arr.length) return;

  sec.innerHTML = `<h3>${title}</h3>`;
  arr.forEach(line => {
    const p = document.createElement("p");
    p.textContent = line;
    sec.appendChild(p);
  });
}

// खास आरती के लिए: objects array [{title, aarti:[...]}]
function fillAartiSection(id, title, arr) {
  const sec = document.getElementById(id);
  sec.innerHTML = "";
  if (!arr || !arr.length) return;

  sec.innerHTML = `<h3>${title}</h3>`;
  arr.forEach(item => {
    if (item.title) {
      const h = document.createElement("h4");
      h.textContent = item.title;
      sec.appendChild(h);
    }
    if (Array.isArray(item.aarti)) {
      item.aarti.forEach(line => {
        const p = document.createElement("p");
        p.textContent = line;
        sec.appendChild(p);
      });
    }
  });
}

initButtons();
</script>

</body>
</html>
