<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>Ask Bhakti â€” Bhakti Panchang</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .btn { margin: 4px; padding: 8px 12px; cursor: pointer; }
    .section { margin: 16px 0; }
    .hidden { display: none; }
    h2 { margin: 8px 0; }
    h3 { margin: 8px 0; }
    h4 { margin: 6px 0; }
    p { margin: 4px 0; }
  </style>
</head>
<body>

  <h1>à¤¦à¥‡à¤µà¥€-à¤¦à¥‡à¤µà¤¤à¤¾ à¤¸à¥‡ à¤ªà¥‚à¤›à¥‡à¤‚</h1>

  <!-- à¤¦à¥‡à¤µà¤¤à¤¾ buttons -->
  <div id="devta-buttons"></div>

  <!-- Loading -->
  <p id="loading" class="hidden">à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...</p>

  <!-- Error -->
  <p id="error" class="hidden"></p>

  <!-- Bhakti content -->
  <div id="content" class="hidden">
    <h2 id="name"></h2>

    <div id="mantra" class="section"></div>
    <div id="aarti" class="section"></div>
    <div id="pujaVidhi" class="section"></div>
    <div id="chalisa" class="section"></div>
    <div id="stotra" class="section"></div>
  </div>

<script>
/* ---------------------------------------------
   Config
--------------------------------------------- */
const DEVTA_LIST = [
  { key: "hanuman", label: "à¤¹à¤¨à¥à¤®à¤¾à¤¨ à¤œà¥€" },
  { key: "shiv", label: "à¤¶à¤¿à¤µ à¤œà¥€" },
  { key: "durga", label: "à¤®à¤¾à¤ à¤¦à¥à¤°à¥à¤—à¤¾" },
  { key: "krishna", label: "à¤¶à¥à¤°à¥€ à¤•à¥ƒà¤·à¥à¤£" },
  { key: "ganesh", label: "à¤—à¤£à¥‡à¤¶ à¤œà¥€" }
];

// same origin à¤•à¥‡ à¤²à¤¿à¤ à¤–à¤¾à¤²à¥€ à¤°à¤–à¥‡à¤‚; à¤…à¤²à¤— backend à¤¹à¥‹ à¤¤à¥‹ origin à¤¡à¤¾à¤²à¥‡à¤‚
const backend = ""; 

/* ---------------------------------------------
   Helpers
--------------------------------------------- */
function hide(el) { el.classList.add("hidden"); }
function show(el) { el.classList.remove("hidden"); }

function initButtons() {
  const container = document.getElementById("devta-buttons");
  DEVTA_LIST.forEach(d => {
    const btn = document.createElement("button");
    btn.textContent = d.label;
    btn.className = "btn";
    btn.onclick = () => fetchData(d.key);
    container.appendChild(btn);
  });
}

async function fetchData(devta) {
  hide(document.getElementById("error"));
  show(document.getElementById("loading"));
  hide(document.getElementById("content"));

  try {
    // à¤¸à¤¹à¥€ API: query parameter
    const res = await fetch(`${backend}/api/ask-bhakti?deity=${encodeURIComponent(devta)}`);
    const json = await res.json();

    // à¤¬à¥ˆà¤•à¤à¤‚à¤¡ à¤¸à¥€à¤§à¥‡ { deity, available, content } à¤¦à¥‡à¤¤à¤¾ à¤¹à¥ˆ
    if (!json || !json.content) throw new Error("Data not found");

    renderContent(json);
  } catch (e) {
    document.getElementById("error").textContent = "à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤²à¥‹à¤¡ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤ªà¤¾à¤ˆ";
    show(document.getElementById("error"));
  } finally {
    hide(document.getElementById("loading"));
  }
}

/* ---------------------------------------------
   Render
--------------------------------------------- */
function renderContent(d) {
  document.getElementById("name").textContent = d.deity || "";

  fillSimpleSection("mantra", "à¤®à¤‚à¤¤à¥à¤°", d.content.mantra);
  fillAartiSection("aarti", "à¤†à¤°à¤¤à¥€", d.content.aarti);
  fillPujaSection("pujaVidhi", "à¤ªà¥‚à¤œà¤¾ à¤µà¤¿à¤§à¤¿", d.content.poojaVidhi);
  fillSimpleSection("chalisa", "à¤šà¤¾à¤²à¥€à¤¸à¤¾", normalizeToLines(d.content.chalisa));
  fillSimpleSection("stotra", "à¤¸à¥à¤¤à¥‹à¤¤à¥à¤°", d.content.stotra);

  show(document.getElementById("content"));
}

/* ---------------------------------------------
   Normalizers
--------------------------------------------- */
// à¤•à¤¿à¤¸à¥€ à¤­à¥€ value à¤•à¥‹ lines array à¤®à¥‡à¤‚ à¤¬à¤¦à¤²à¥‡à¤‚ (string/array/empty)
function normalizeToLines(value) {
  if (!value) return [];
  if (Array.isArray(value)) {
    return value
      .map(v => (typeof v === "string" ? v.trim() : ""))
      .filter(v => v.length > 0);
  }
  if (typeof value === "string") {
    return value
      .split("\n")
      .map(v => v.trim())
      .filter(v => v.length > 0);
  }
  return [];
}

// à¤†à¤°à¤¤à¥€ items à¤•à¥‹ à¤à¤•à¤¸à¤®à¤¾à¤¨ à¤¬à¤¨à¤¾à¤à¤‚: [{ title, aarti:[lines] }]
function normalizeAartiItems(arr) {
  if (!Array.isArray(arr)) return [];
  return arr.map(item => {
    // item object à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆ à¤¯à¤¾ string/arrayâ€”à¤¸à¤¬à¤•à¥‹ normalize à¤•à¤°à¥‡à¤‚
    if (typeof item === "string") {
      // à¤¸à¤¿à¤°à¥à¤«à¤¼ title à¤®à¤¿à¤²à¤¾â€”lines à¤¨à¤¹à¥€à¤‚; title à¤¦à¤¿à¤–à¤¾à¤à¤, lines à¤–à¤¾à¤²à¥€
      return { title: item.trim(), aarti: [] };
    }
    if (Array.isArray(item)) {
      // à¤¸à¥€à¤§à¥‡ lines à¤®à¤¿à¤²à¥€à¤‚â€”title à¤¨à¤¹à¥€à¤‚
      return { title: "", aarti: normalizeToLines(item) };
    }
    // object case
    const title = typeof item?.title === "string" ? item.title.trim() : "";
    const lines = normalizeToLines(item?.aarti);
    return { title, aarti: lines };
  });
}
// à¤ªà¥‚à¤œà¤¾ à¤µà¤¿à¤§à¤¿ à¤¸à¥‡à¤•à¥à¤¶à¤¨: objects array [{ text }, { pdf, source }]
function fillPujaSection(id, title, arr) {
  const sec = document.getElementById(id);
  sec.innerHTML = "";

  if (!Array.isArray(arr) || !arr.length) return;

  const h3 = document.createElement("h3");
  h3.textContent = title;
  sec.appendChild(h3);

  arr.forEach(item => {
    if (item.text) {
      const p = document.createElement("p");
      p.textContent = item.text;
      sec.appendChild(p);
    }
    if (item.pdf) {
      const a = document.createElement("a");
      a.href = item.pdf;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.textContent = `ðŸ“„ ${item.source || "PDF à¤²à¤¿à¤‚à¤•"}`;
      sec.appendChild(a);
    }
  });
}

/* ---------------------------------------------
   Sections
--------------------------------------------- */
// à¤¸à¤¾à¤§à¤¾à¤°à¤£ à¤¸à¥‡à¤•à¥à¤¶à¤¨: lines array
function fillSimpleSection(id, title, arr) {
  const sec = document.getElementById(id);
  sec.innerHTML = "";
  const lines = normalizeToLines(arr);
  if (!lines.length) return;

  const h3 = document.createElement("h3");
  h3.textContent = title;
  sec.appendChild(h3);

  lines.forEach(line => {
    const p = document.createElement("p");
    p.textContent = line;
    sec.appendChild(p);
  });
}

// à¤†à¤°à¤¤à¥€ à¤¸à¥‡à¤•à¥à¤¶à¤¨: objects array [{title, aarti:[...]}]
function fillAartiSection(id, title, arr) {
  const sec = document.getElementById(id);
  sec.innerHTML = "";

  const items = normalizeAartiItems(arr);
  if (!items.length) return;

  const h3 = document.createElement("h3");
  h3.textContent = title;
  sec.appendChild(h3);

  items.forEach(item => {
    // Title (à¤…à¤—à¤° à¤¹à¥ˆ)
    if (item.title) {
      const h4 = document.createElement("h4");
      h4.textContent = item.title;
      sec.appendChild(h4);
    }
    // Lines (à¤…à¤—à¤° à¤¹à¥ˆà¤‚)
    if (Array.isArray(item.aarti) && item.aarti.length) {
      item.aarti.forEach(line => {
        const p = document.createElement("p");
        p.textContent = line;
        sec.appendChild(p);
      });
    }
  });
}

/* ---------------------------------------------
   Boot
--------------------------------------------- */
initButtons();
</script>

</body>
</html>
