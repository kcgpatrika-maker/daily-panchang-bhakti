<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panchang ‚Äì Bhakti Guide</title>
<meta name="description" content="‡§Ü‡§ú ‡§ï‡§æ ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó, ‡§µ‡•ç‡§∞‡§§-‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞, ‡§¶‡•á‡§µ‡•Ä-‡§¶‡•á‡§µ‡§§‡§æ ‡§ï‡•Ä ‡§™‡•Ç‡§ú‡§æ ‡§µ‡§ø‡§ß‡§ø, ‡§Ü‡§∞‡§§‡•Ä, ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ ‡§î‡§∞ ‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞‡•§">
<meta name="keywords" content="‡§Ü‡§ú ‡§ï‡§æ ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó, ‡§µ‡•ç‡§∞‡§§, ‡§™‡•Ç‡§ú‡§æ, ‡§Ü‡§∞‡§§‡•Ä, ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ, ‡§≠‡§ï‡•ç‡§§‡§ø">
<meta name="robots" content="index, follow">
<style>
body{margin:0;font-family:system-ui;background:#fff8e1;color:#4e342e}
header{background:linear-gradient(90deg,#ff9800,#ffb300);padding:10px 12px;color:#fff}
.header-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
.header-title{font-size:18px;font-weight:800;white-space:nowrap;letter-spacing:.3px}
.tagline{font-size:13px;margin-top:2px;font-weight:500;opacity:.95}
.header-actions button{background:#fff;border:none;border-radius:8px;padding:6px 10px;font-size:12px;font-weight:600;cursor:pointer}
.section{padding:12px}
.card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.panchang p{margin:4px 0;font-size:14px}
.panchang p:first-child{font-size:16px;font-weight:700}
.ask-row{display:flex;gap:6px}
.highlight{background:linear-gradient(135deg,#ffe082,#ffcc80);border-left:5px solid #ff6f00}
.highlight h3{margin:0 0 6px;font-size:15px;color:#b71c1c}
.highlight ul{margin:0;padding-left:18px}
.highlight li{font-size:14px}
.ask-box h3{margin:0 0 8px;font-size:15px}
.ask-row input{flex:1;padding:8px}
.ask-row button{padding:8px 10px} 
.result button{display:block;width:100%;margin-top:6px}
.key-pages ul{margin:0;padding-left:18px}
.key-pages li{margin:4px 0;font-size:14px}
footer{text-align:center;padding:10px;background:#fff3e0;font-size:13px;color:#4e342e}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000}
.modal-content{background:#fff;border-radius:12px;margin:12% auto;padding:15px;width:90%;max-height:70%;overflow-y:auto}
.close{float:right;font-size:20px;cursor:pointer}
  /* ===== Vrat Katha Right Panel Fix ===== */

.vrat-box{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}

.vrat-left{
  flex:1;
}

.vrat-right{
  min-width:110px;
  text-align:right;
}

.vrat-title{
  font-weight:700;
  color:#4a148c;
  font-size:16px;
  text-align: center;
  margin-bottom:4px;
}

.katha-btn {
  display:block;       /* block ‡§∞‡§π‡§®‡•á ‡§¶‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§ä‡§™‡§∞-‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§ñ‡•á‡§Ç */
  width:auto;          /* auto width ‡§§‡§æ‡§ï‡§ø ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ú‡§ø‡§§‡§®‡§æ ‡§π‡•ã ‡§â‡§§‡§®‡§æ ‡§π‡•Ä ‡§∏‡•ç‡§™‡•á‡§∏ ‡§≤‡•á */
  margin:4px auto;     /* auto margin ‡§∏‡•á center alignment */
  padding:4px 10px;    /* padding ‡§ï‡§Æ */
  font-size:12px;
  border:none;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
  text-align:center;   /* ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü center ‡§Æ‡•á‡§Ç */
}

.katha-btn.video{
  background:#c62828;
}

.katha-btn.audio{
  background:#2e7d32;
}
.ai-options{
  display:flex;
  gap:6px;
  margin-top:8px;
}

.ai-btn{
  flex:1;
  border:1px solid #ccc;
  border-radius:10px;
  background:#f2f2f2;
  color:#777;
  padding:6px 4px;
  font-size:12px;
  text-align:center;
  cursor:not-allowed;
}

.ai-btn .emoji{
  display:block;
  font-size:18px;
  line-height:1.2;
}

.ai-btn .text{
  display:block;
  font-size:11px;
  margin-top:2px;
}

.ai-btn.active{
  background:#2e7d32;
  color:#fff;
  border:none;
  cursor:pointer;
}
 .panchang-wrap{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.panchang-left{
  flex:1;
  font-size:14px;
  line-height:1.6;
}

.panchang-source{
  font-size:11px;
  color:#666;
  margin-top:4px;
}

.panchang-right{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-width:80px;
}

.religious-btn{
  width:52px;
  height:52px;
  border-radius:50%;
  border:none;
  background:#ff9800;
  color:#fff;
  font-size:22px;
  cursor:pointer;
}

.btn-label{
  margin-top:6px;
  font-size:15px;
  font-weight:600;
  text-align:center;
}

  .channel-list {
  display: flex;
  justify-content: space-around;
  gap: 6px;
  margin: 6px 0;
}

.channel-btn {
  border: none;
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
  color: #fff;
}

/* Layout styles */
.channel-list {
  display: flex;
  flex-wrap: wrap;          /* ‡§¨‡§ü‡§® wrap ‡§π‡•ã‡§Ç‡§ó‡•á */
  justify-content: center;  /* center alignment */
  gap: 8px;                 /* ‡§¨‡§ü‡§® ‡§ï‡•á ‡§¨‡•Ä‡§ö spacing */
  margin: 8px 0;
}

.channel-btn {
  flex: 1 1 45%;            /* ‡§õ‡•ã‡§ü‡•á ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ 2 ‡§¨‡§ü‡§® ‡§™‡•ç‡§∞‡§§‡§ø row */
  max-width: 140px;         /* ‡§¨‡§ü‡§® ‡§ï‡•Ä ‡§ö‡•å‡§°‡§º‡§æ‡§à limit */
  text-align: center;
  border: none;
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
  color: #fff;
}

/* Branding styles */
.channel-btn.sanskar {
  background: #e65100;
  font-family: "Trebuchet MS", sans-serif;
}
.channel-btn.sanskar:hover {
  background: #bf360c;
}

.channel-btn.aastha {
  background: #1565c0;
  font-family: "Verdana", sans-serif;
}
.channel-btn.aastha:hover {
  background: #0d47a1;
}

.channel-btn.sadhna {
  background: #b71c1c;
  font-family: "Georgia", serif;
}
.channel-btn.sadhna:hover {
  background: #7f0000;
}

.channel-btn.arihant {
  background: #2e7d32; /* ‡§π‡§∞‡§æ ‡§∞‡§Ç‡§ó */
  font-family: "Tahoma", sans-serif;
}
.channel-btn.arihant:hover {
  background: #1b5e20;
}

.channel-btn.subh {
  background: #6a1b9a; /* ‡§¨‡•à‡§Ç‡§ó‡§®‡•Ä ‡§∞‡§Ç‡§ó */
  font-family: "Courier New", monospace;
}
.channel-btn.subh:hover {
  background: #4a148c;
}

/* ===== MOBILE ===== */
@media (max-width:600px){
  .panchang-left{font-size:13px}
  .panchang-left p:first-child{font-size:17px;font-weight:700}
  .btn-label{font-size:15px}
}
}
</style>
</head>

<body>

<header>
  <div class="header-row">
    <div style="display:flex;align-items:center;gap:8px;">
      <!-- Logo -->
      <img src="/logo.png" alt="Panchang Logo"
           style="height:38px;width:auto">

      <div>
        <div class="header-title">Panchang ‚Äì Bhakti Guide</div>
        <div class="tagline">‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‚Ä¢ ‡§™‡•Ç‡§ú‡§® ‚Ä¢ ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</div>
      </div>
    </div>

    <div class="header-actions">
      <button onclick="sharePage()">üîó ‡§∂‡•á‡§Ø‡§∞</button>
    </div>
  </div>
</header>

<div class="section">

<div class="panchang-wrap">
  <div class="panchang-left">

    <p> <b id="dateText"></b> | <b id="vaar"></b></p>

    <p>
      <span style="color:#d84315;font-weight:700;font-size:15px" id="maas"></span> ¬∑
      <span style="color:#6a1b9a;font-weight:700;font-size:15px" id="paksha"></span> ¬∑
      <span style="color:#b71c1c;font-weight:700;font-size:15px" id="tithi"></span>
    </p>

    <p style="margin-top:-2px;font-size:13px">
      ‡§µ‡§ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§Ç‡§µ‡§§: <b id="vikram"></b>
    </p>

    <p style="margin-top:-4px;font-size:13px">
      ‡§∂‡§ï ‡§∏‡§Ç‡§µ‡§§: <b id="shak"></b>
    </p>

    <p style="font-size:13px">‡§∏‡•Ç‡§∞‡•ç‡§Ø‡•ã‡§¶‡§Ø: <b id="sunrise"></b> | ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§: <b id="sunset"></b></p>

    <p style="margin-top:-3px;font-size:13px">‡§ö‡§Ç‡§¶‡•ç‡§∞‡•ã‡§¶‡§Ø: <b id="moonrise"></b> | ‡§ö‡§Ç‡§¶‡•ç‡§∞‡§æ‡§∏‡•ç‡§§: <b id="moonset"></b></p>

    <div style="font-size:12px;color:#555;margin-top:-2px" id="panchangSource">
      ‡§∏‡•ç‡§∞‡•ã‡§§: ‚Äî
    </div>

  </div>

  <div class="panchang-right">
    <button class="religious-btn" onclick="openReligiousMessage()">‚ú®</button>
    <div class="btn-label">
      ‡§Ü‡§ú ‡§ï‡§æ<br>‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂
    </div>
  </div>
</div>

<div style="display:flex; gap:5px; flex-wrap:nowrap; margin-top:8px; margin-bottom:10px;">
  <button onclick="openChoghadiya()"
    style="padding:6px 10px;border-radius:8px;border:none;
    background:#ff9800;color:#fff;font-size:14px;white-space:nowrap;">
    ‚è∞ ‡§ö‡•å‡§ò‡§°‡§ø‡§Ø‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç
  </button>
  <button onclick="callJyotishi()"
    style="padding:6px 10px;border-radius:8px;border:none;
    background:#4caf50;color:#fff;font-size:14px;white-space:nowrap;">
    üìû ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑‡•Ä ‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï
  </button>

  <button onclick="openRashiIshta()"
    style="padding:6px 10px;border-radius:8px;border:none;
    background:#8e24aa;color:#fff;font-size:14px;white-space:nowrap;">
    üîÆ ‡§á‡§∑‡•ç‡§ü‡§¶‡•á‡§µ ‡§ú‡§æ‡§®‡•á‡§Ç
  </button>

</div>
  
<div class="card highlight vrat-box">
  <div class="vrat-left">
    <h3>üîî ‡§µ‡•ç‡§∞‡§§ / ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞</h3>
    <ul id="festivalList"></ul>
  </div>

  <!-- RIGHT FIXED CATEGORY -->
  <div class="vrat-right">
    <div class="vrat-title">üìø ‡§µ‡•ç‡§∞‡§§ ‡§ï‡§•‡§æ‡§è‡§Å</div>

    <button onclick="openVideoKatha()" class="katha-btn video">
      ‚ñ∂Ô∏è ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡§•‡§æ
    </button>

   <button onclick="openAudioModal()" class="katha-btn audio">
üéß ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡§•‡§æ
</button>
  </div>
</div>

<h3 style="margin-top:10px;font-size:17px;color:#4a148c;">
ü§ñ AI ‡§∏‡•á ‡§ú‡§æ‡§®‡•á‡§Ç ‡§≠‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§≠‡§Ç‡§°‡§æ‡§∞
</h3>

<p style="font-size:13px;color:#555;margin-bottom:6px">
‡§¶‡•á‡§µ‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Æ‡§Ç‡§§‡•ç‡§∞, ‡§Ü‡§∞‡§§‡•Ä, ‡§™‡•Ç‡§ú‡§æ ‡§µ‡§ø‡§ß‡§ø ‡§Ü‡§¶‡§ø ‡§™‡§æ‡§è‡§Ç
</p>

<div class="ask-row">
  <input id="query" placeholder="‡§¶‡•á‡§µ‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§∂‡§ø‡§µ / Shiv)">
  <button onclick="ask()">Ask</button>
  <button onclick="resetAsk()">Reset</button>
</div>

<!-- AI OPTIONS (FIXED PLACE) -->
<div class="ai-options">
  <button class="ai-btn" onclick="showSection('mantra')">
    <span class="emoji">üîπ</span>
    <span class="text">‡§Æ‡§Ç‡§§‡•ç‡§∞</span>
  </button>
  <button class="ai-btn" onclick="showSection('aarti')">
    <span class="emoji">üéµ</span>
    <span class="text">‡§Ü‡§∞‡§§‡•Ä</span>
  </button>
  <button class="ai-btn" onclick="showSection('poojaVidhi')">
    <span class="emoji">üôè</span>
    <span class="text">‡§™‡•Ç‡§ú‡§æ ‡§µ‡§ø‡§ß‡§ø</span>
  </button>
  <button class="ai-btn" onclick="showSection('chalisa')">
    <span class="emoji">üìú</span>
    <span class="text">‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ</span>
  </button>
  <button class="ai-btn" onclick="showSection('stotra')">
    <span class="emoji">üïâÔ∏è</span>
    <span class="text">‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞</span>
  </button>
</div>

<!-- INFO LINE -->
<div id="aiInfo" style="display:none;margin-top:8px;">
  <h3 id="aiTitle" style="margin:4px 0"></h3>
  <p style="font-size:12px;color:#555">
    ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç
  </p>
</div>

<!-- CONTENT AREA -->
<div id="result" class="result"></div>
<div class="card"> 
  <h3>üì∫ ‡§≠‡§ï‡•ç‡§§‡§ø ‡§ö‡•à‡§®‡§≤ ‡§¶‡•á‡§ñ‡•á‡§Ç</h3>
  <div class="channel-list">
  <button class="channel-btn sanskar" onclick="window.open('https://www.youtube.com/@SanskargroupInOfficial/live','_blank')">
    Sanskar TV ‚ñ∂Ô∏è
  </button>

  <button class="channel-btn aastha" onclick="window.open('https://www.youtube.com/@AasthaChannel/live','_blank')">
    Aastha TV ‚ñ∂Ô∏è
  </button>

  <button class="channel-btn sadhna" onclick="window.open('https://www.youtube.com/@SadhnaTV/live','_blank')">
    Sadhna TV ‚ñ∂Ô∏è
  </button>

  <button class="channel-btn arihant" onclick="window.open('https://www.youtube.com/@arihanttv/live','_blank')">
    Arihant TV ‚ñ∂Ô∏è
  </button>

  <button class="channel-btn subh" onclick="window.open('https://www.youtube.com/@ShubhTV/live','_blank')">
    Subh TV ‚ñ∂Ô∏è
  </button>
</div>
</div>
<footer> ¬© 2025 | ‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó<br> ‡§∏‡§Ç‡§ï‡§≤‡§®: ‡§ï‡•à‡§≤‡§æ‡§∂ ‡§ó‡•å‡§§‡§Æ </footer>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close" onclick="modal.style.display='none'">√ó</span>
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <div id="modalPDF" style="margin-top:10px"></div>
  </div>
</div>
<!-- üì∫ Dharmik Sandesh TV Box -->
<div class="modal" id="sandeshModal">
  <div class="modal-content">
    <span class="close" onclick="closeSandesh()">√ó</span>

    <h3 id="sandeshTitle">üìø ‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂</h3>

    <p style="font-size:12px;color:#777;margin-bottom:6px;">
      ‡§∏‡•ç‡§∞‡•ã‡§§: <b id="sandeshSource"></b>
    </p>

    <div id="sandeshBody"
         style="font-size:15px;line-height:1.6;color:#4e342e;">
    </div>

    <button onclick="shareSandesh()"
      style="
        margin-top:10px;
        padding:6px 10px;
        border:none;
        border-radius:8px;
        background:#25D366;
        color:#fff;
        font-size:13px;
      ">
      üì§ WhatsApp ‡§™‡§∞ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
    </button>
  </div>
</div> 
  
<script>
/* ===============================
        PANCHANG FETCH + RENDER
=============================== */
async function loadPanchang() {
  try {
    const res = await fetch("https://bhakti-panchang-backend.onrender.com/api/panchang");
    const data = await res.json();

    // Date & Day
    dateText.innerText = data.date ?? "‚Äî";
    vaar.innerText = data.day ?? "‚Äî";

    // Sunrise / Sunset
    sunrise.innerText = data.sunrise ?? "‚Äî";
    sunset.innerText = data.sunset ?? "‚Äî";

    // Moonrise / Moonset
    moonrise.innerText = data.moonrise ?? "‚Äî";
    moonset.innerText = data.moonset ?? "‚Äî";

    // Vikram & Shak Samvat
    vikram.innerText = data.vikramSamvat ?? "‚Äî";
    shak.innerText   = data.shakaSamvat ?? "‚Äî";

    // Masa, Tithi, Paksha
    maas.innerText = data.month ?? "‚Äî";
    paksha.innerText = data.paksha ?? "‚Äî";
    tithi.innerText = data.tithi ?? "‚Äî";

    // Festivals / Vrat (optional future use)
    if (Array.isArray(data.festivalList) && data.festivalList.length > 0) {
      festivalList.innerHTML = data.festivalList.map(f => `<li>${f}</li>`).join("");
    } else {
      festivalList.innerHTML = "<li>‡§ï‡•ã‡§à ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§µ‡•ç‡§∞‡§§ ‡§®‡§π‡•Ä‡§Ç</li>";
      // Religious message modal content
document.getElementById("sandeshBody").innerText = data.dharmikMessage ?? "";
document.getElementById("sandeshSource").innerText = data.dharmikSource ?? "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó";
    }

    // Source (footer / info)
    const panchangSource = document.getElementById("panchangSource");
    if(panchangSource){
      panchangSource.innerText = `üìå ‡§∏‡•ç‡§∞‡•ã‡§§: ${data.source ?? "Bhakti Panchang API"}`;
    }

  } catch (err) {
    console.error("Frontend Panchang load error:", err);
    festivalList.innerHTML = "<li>‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ</li>";
  }
}

// Page load ‡§™‡§∞ Panchang ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
loadPanchang();

/* ===============================
   COMMON MODAL REFERENCES
=============================== */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

/* MENU */
function toggleKathaMenu(){
  const m = document.getElementById("kathaMenu");
  m.style.display = m.style.display === "block" ? "none" : "block";
}

/* VIDEO KATHA */
async function openVideoKatha(){
  const res = await fetch("vrat-katha-list.json");
  const data = await res.json();
  modalTitle.innerText = "‚ñ∂Ô∏è ‡§µ‡•ç‡§∞‡§§ ‡§ï‡§•‡§æ (‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã)";
  modalBody.innerHTML = "<ul>" + data.video.map(k =>
    `<li><a href="#" onclick="playVideo('${k}')">${k.replace("‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã","")}</a></li>`
  ).join("") + "</ul>";
  modal.style.display = "block";
}

function playVideo(q){
  window.open(
    "https://www.youtube.com/results?search_query=" + encodeURIComponent(q),
    "_blank"
  );
  closeMainModal();
}

/* AUDIO KATHA */
async function openAudioModal(){
  const res = await fetch("vrat-katha-list.json");
  const data = await res.json();
  modalTitle.innerText = "üéß ‡§µ‡•ç‡§∞‡§§ ‡§ï‡§•‡§æ (‡§ë‡§°‡§ø‡§Ø‡•ã)";
  modalBody.innerHTML = "<ul>" + data.audio.map(k =>
    `<li><a href="#" onclick="openAudioYT('${k}')">${k.replace("‡§ë‡§°‡§ø‡§Ø‡•ã ‡§π‡§ø‡§Ç‡§¶‡•Ä","")}</a></li>`
  ).join("") + "</ul>";
  modal.style.display = "block";
}

function openAudioYT(query){
  window.open(
    "https://www.youtube.com/results?search_query=" + encodeURIComponent(query),
    "_blank"
  );
  closeMainModal();
}

/* CLOSE MODAL */
function closeMainModal(){
  modal.style.display = "none";
}

/* ===============================
   ASK BHAKTI ‚Äì STEP B (FINAL STABLE)
=============================== */

// English ‚Üí Hindi alias
const deityAliasMap = {
  shiv: "‡§∂‡§ø‡§µ",
  shiva: "‡§∂‡§ø‡§µ",
  mahadev: "‡§∂‡§ø‡§µ",
  bholenath: "‡§∂‡§ø‡§µ",
  shankar: "‡§∂‡§ø‡§µ",

  hanuman: "‡§π‡§®‡•Å‡§Æ‡§æ‡§®",
  bajrangbali: "‡§π‡§®‡•Å‡§Æ‡§æ‡§®",
  maruti: "‡§π‡§®‡•Å‡§Æ‡§æ‡§®",

  ram: "‡§∞‡§æ‡§Æ",
  rama: "‡§∞‡§æ‡§Æ",
  shriram: "‡§∞‡§æ‡§Æ"
};

const query = document.getElementById("query");
const result = document.getElementById("result");
const aiInfo = document.getElementById("aiInfo");
const aiTitle = document.getElementById("aiTitle");
const aiButtons = document.querySelectorAll(".ai-btn");

// UI ‚Üí data keys mapping
const TYPE_MAP = {
  mantra: "mantra",
  aarti: "aarti",
  poojaVidhi: "poojaVidhi", // ‚Üê ‡§Ø‡§π‡§æ‡§Å "puja" ‡§ï‡•Ä ‡§ú‡§ó‡§π "poojaVidhi" ‡§∞‡§ñ‡§ø‡§è‡§æ
  chalisa: "chalisa",
  stotra: "stotra",
};

let bhaktiData = null;

/* ========= ASK ========= */
async function ask() {
  let q = query.value.trim().toLowerCase();
  q = deityAliasMap[q] || q;

  result.innerHTML = "";
  aiInfo.style.display = "none";
  bhaktiData = null;

  // üî¥ ‡§™‡§π‡§≤‡•á ‡§∏‡§≠‡•Ä ‡§¨‡§ü‡§® disable + inactive
  aiButtons.forEach(btn => {
    btn.disabled = true;
    btn.classList.remove("active");
  });

  if (!q) {
    result.innerHTML = "<p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•á‡§µ‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</p>";
    return;
  }

  try {
    const res = await fetch("https://bhakti-panchang-backend.onrender.com/api/ask-bhakti", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ deity: q })
    });
    const data = await res.json();

    if (!data || !data.content) {
      result.innerHTML = "<p>‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</p>";
      return;
    }

    bhaktiData = data.content;

    // üü¢ ‡§ú‡§ø‡§®‡§ï‡§æ data ‡§π‡•à ‡§µ‡§π‡•Ä ‡§¨‡§ü‡§® enable (mapped keys)
    aiButtons.forEach(btn => {
      const uiType = btn.getAttribute("onclick").match(/'(.*?)'/)[1]; 
      const key = TYPE_MAP[uiType];
      const val = bhaktiData[key];

      let hasData = false;

      if (uiType === "chalisa" && Array.isArray(val)) {
        hasData = val.some(item => item.pdf || item.text);
      } else if (uiType === "stotra" && Array.isArray(val)) {
        hasData = val.some(item => item.pdf || item.text);
      } else if (uiType === "mantra" && Array.isArray(val)) {
        hasData = val.length > 0; // ‚úÖ ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§´‡§º check 
      } else { hasData =
    (Array.isArray(val) && val.length > 0) ||
    (typeof val === "string" && val.trim().length > 0);
}

      if (hasData) {
        btn.disabled = false;
        btn.classList.add("active"); // ‡§π‡§∞‡§æ
      }
    });

    aiTitle.innerText = `üôè ${query.value.trim()}`;
    aiInfo.style.display = "block";

  } catch (e) {
    console.error(e);
    result.innerHTML = "<p>‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>";
  }
}

/* ========= SHOW SECTION ========= */
function showSection(type) {
  if (!bhaktiData) return;

  aiButtons.forEach(btn => btn.classList.remove("active"));
  const activeBtn = document.querySelector(`.ai-btn[onclick*="${type}"]`);
  if (activeBtn) activeBtn.classList.add("active");

  const key = TYPE_MAP[type];
  const data = bhaktiData[key];
  if (!data) return;

  let html = "";

  // ‡§Ü‡§∞‡§§‡•Ä
  if (type === "aarti" && Array.isArray(data)) {
    data.forEach(item => {
      html += `<p><b>${item.title || ""}</b></p>`;
      if (Array.isArray(item.aarti)) {
        item.aarti.forEach(line => { html += `<p>${line}</p>`; });
      }
      html += `<hr>`;
    });
  }

  // ü™∑ ‡§™‡•Ç‡§ú‡§æ ‡§µ‡§ø‡§ß‡§ø
  else if (type === "poojaVidhi" && Array.isArray(data)) {
    data.forEach(item => {
      if (item.text) {
        html += `<p class="font-semibold whitespace-pre-line">${item.text}</p><hr>`;
      }
      if (item.pdf) {
        html += `<p><a href="${item.pdf}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">üìÑ ${item.source || "PDF ‡§≤‡§ø‡§Ç‡§ï"}</a></p><hr>`;
      }
    });
  }

  // ü™∑ ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ
  else if (type === "chalisa" && Array.isArray(data)) {
  data.forEach(item => {
    if (item.pdf) {
      html += `<p><a href="${item.pdf}" target="_blank" rel="noopener noreferrer"
        class="text-green-600 font-bold">üìÑ ${item.source || "PDF ‡§≤‡§ø‡§Ç‡§ï"}</a></p><hr>`;
    }
    if (item.text) {
      html += `<p>${item.text}</p><hr>`;
    }
  });
}

  // ‡§Æ‡§Ç‡§§‡•ç‡§∞/‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞
  else if (Array.isArray(data)) {
    data.forEach(line => {
      const t = typeof line === "string" ? line.trim() : "";
      if (t) html += `<p>${t}</p>`;
    });
  } else if (typeof data === "string") {
    data.split("\n").forEach(line => {
      const t = line.trim();
      if (t) html += `<p>${t}</p>`;
    });
  }

  result.innerHTML = html || "<p>‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</p>";
  result.scrollIntoView({ behavior: "smooth" });
}

/* ========= RESET ========= */
function resetAsk() {
  query.value = "";
  result.innerHTML = "";
  aiInfo.style.display = "none";
  bhaktiData = null;

  aiButtons.forEach(btn => {
    btn.disabled = true;
    btn.classList.remove("active");
  });
}

/* ========= SHOW SECTION ========= */
function showSection(type) {
  if (!bhaktiData) return;

  aiButtons.forEach(btn => btn.classList.remove("active"));
  const activeBtn = document.querySelector(`.ai-btn[onclick*="${type}"]`);
  if (activeBtn) activeBtn.classList.add("active");

  const key = TYPE_MAP[type];
  const data = bhaktiData[key];
  if (!data) return;

  let html = "";

  // ‚úÖ ‡§Æ‡§Ç‡§§‡•ç‡§∞ (‡§Ö‡§≤‡§ó block ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á)
  if (type === "mantra" && Array.isArray(data)) {
    data.forEach(line => {
      const t = typeof line === "string" ? line.trim() : "";
      if (t) html += `<p>${t}</p>`;
    });
  }

  // ‡§Ü‡§∞‡§§‡•Ä
  else if (type === "aarti" && Array.isArray(data)) {
    data.forEach(item => {
      html += `<p><b>${item.title || ""}</b></p>`;
      if (Array.isArray(item.aarti)) {
        item.aarti.forEach(line => { html += `<p>${line}</p>`; });
      }
      html += `<hr>`;
    });
  }

  // ü™∑ ‡§™‡•Ç‡§ú‡§æ ‡§µ‡§ø‡§ß‡§ø
  else if (type === "poojaVidhi" && Array.isArray(data)) {
    data.forEach(item => {
      if (item.text) {
        html += `<p class="font-semibold whitespace-pre-line">${item.text}</p><hr>`;
      }
      if (item.pdf) {
        html += `<p><a href="${item.pdf}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">üìÑ ${item.source || "PDF ‡§≤‡§ø‡§Ç‡§ï"}</a></p><hr>`;
      }
    });
  }

  // ü™∑ ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ
  else if (type === "chalisa" && Array.isArray(data)) {
    data.forEach(item => {
      if (item.pdf) {
        html += `<p><a href="${item.pdf}" target="_blank" rel="noopener noreferrer"
          class="text-green-600 font-bold">üìÑ ${item.source || "PDF ‡§≤‡§ø‡§Ç‡§ï"}</a></p><hr>`;
      }
      if (item.text) {
        html += `<p>${item.text}</p><hr>`;
      }
    });
  }

  // ‚úÖ ‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞ (‡§Ö‡§≤‡§ó block, pdf + text)
  else if (type === "stotra" && Array.isArray(data)) {
    data.forEach(item => {
      if (item.pdf) {
        html += `<p><a href="${item.pdf}" target="_blank" rel="noopener noreferrer"
          class="text-purple-600 font-bold">üìÑ ${item.source || "PDF ‡§≤‡§ø‡§Ç‡§ï"}</a></p><hr>`;
      }
      if (item.text) {
        html += `<p>${item.text}</p><hr>`;
      }
    });
  }

  result.innerHTML = html || "<p>‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</p>";
  result.scrollIntoView({ behavior: "smooth" });
}

/* ========= RESET ========= */
function resetAsk() {
  query.value = "";
  result.innerHTML = "";
  aiInfo.style.display = "none";
  bhaktiData = null;

  aiButtons.forEach(btn => {
    btn.disabled = true;
    btn.classList.remove("active");
  });
}

/* ===============================
      COMMON MODALS
=============================== */
function openChoghadiya(){
  modalTitle.innerText="‚è∞ ‡§Ü‡§ú ‡§ï‡§æ ‡§ö‡•å‡§ò‡§°‡§º‡§ø‡§Ø‡§æ";
  modalBody.innerHTML=`<img src="choghadiya.png" style="width:100%">`;
  modal.style.display="block";
}

function callJyotishi(){
  window.location.href="tel:919414335462";
}

function openRashiIshta(){
  modalTitle.innerText="üîÆ ‡§∞‡§æ‡§∂‡§ø ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§á‡§∑‡•ç‡§ü ‡§¶‡•á‡§µ";
  modalBody.innerHTML=`<img src="rashi-ishta-dev.png" style="width:100%">`;
  modal.style.display="block";
}

function sharePage(){
  navigator.share?.({
    title:"Aaj Ka Panchang",
    url:location.href
  }) || navigator.clipboard.writeText(location.href);
}

/* Outside click close */
window.onclick = e=>{
  if(e.target===modal) modal.style.display="none";
};
  /* ===============================
   üìø DHARMIK SANDESH (DAY BASED)
=============================== */

const dharmikSandeshMap = {
  "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞": {
    source: "‡§∂‡§ø‡§µ ‡§™‡•Å‡§∞‡§æ‡§£",
    text: "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡§®, ‡§µ‡§ö‡§® ‡§î‡§∞ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§∂‡•Å‡§¶‡•ç‡§ß‡§§‡§æ ‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§∂‡§ø‡§µ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•á ‡§ï‡§∑‡•ç‡§ü ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§"
  },
  "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞": {
    source: "‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ",
    text: "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§∏‡§æ‡§π‡§∏ ‡§î‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§≠‡§æ‡§µ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§≠‡§Ø ‡§î‡§∞ ‡§¨‡§æ‡§ß‡§æ ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§"
  },
  "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞": {
    source: "‡§≠‡§æ‡§ó‡§µ‡§§ ‡§ó‡•Ä‡§§‡§æ",
    text: "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞ ‡§ú‡•ç‡§û‡§æ‡§® ‡§î‡§∞ ‡§µ‡§ø‡§µ‡•á‡§ï ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§∏‡•ã‡§ö-‡§∏‡§Æ‡§ù‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡§´‡§≤‡§§‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§"
  },
  "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞": {
    source: "‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•Å‡§∞‡§æ‡§£",
    text: "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§ó‡•Å‡§∞‡•Å ‡§î‡§∞ ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ ‡§î‡§∞ ‡§∂‡•Å‡§≠ ‡§´‡§≤ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§"
  },
  "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞": {
    source: "‡§∂‡•ç‡§∞‡•Ä‡§∏‡•Ç‡§ï‡•ç‡§§",
    text: "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡§æ‡§§‡§æ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡•å‡§≠‡§æ‡§ó‡•ç‡§Ø ‡§î‡§∞ ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§¨‡§¢‡§º‡§§‡•Ä ‡§π‡•à‡•§"
  },
  "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞": {
    source: "‡§∂‡§®‡§ø ‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞",
    text: "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞ ‡§∏‡§Ç‡§Ø‡§Æ ‡§î‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§∂‡§®‡§ø ‡§ï‡•É‡§™‡§æ ‡§¶‡§ø‡§≤‡§æ‡§§‡§æ ‡§π‡•à‡•§"
  },
  "‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞": {
    source: "‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§â‡§™‡§æ‡§∏‡§®‡§æ",
    text: "‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§¨‡§≤ ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§ï‡•ã ‡§Ö‡§∞‡•ç‡§ò‡•ç‡§Ø ‡§¶‡•á‡§®‡§æ ‡§§‡•á‡§ú ‡§¨‡§¢‡§º‡§æ‡§§‡§æ ‡§π‡•à‡•§"
  }
};

// ‚úÖ Helper: fallback from map (day-based)
function getFallbackSandesh() {
  try {
    const dayEl = document.getElementById("vaar");
    const day = (dayEl?.innerText || "").trim();
    const map = {
      "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞": { source: "‡§∂‡§ø‡§µ ‡§™‡•Å‡§∞‡§æ‡§£", text: "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡§®, ‡§µ‡§ö‡§® ‡§î‡§∞ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§∂‡•Å‡§¶‡•ç‡§ß‡§§‡§æ ‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§∂‡§ø‡§µ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•á ‡§ï‡§∑‡•ç‡§ü ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§" },
      "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞": { source: "‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ", text: "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§∏‡§æ‡§π‡§∏ ‡§î‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§≠‡§æ‡§µ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§≠‡§Ø ‡§î‡§∞ ‡§¨‡§æ‡§ß‡§æ ‡§¶‡•Ç‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§" },
      "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞": { source: "‡§≠‡§æ‡§ó‡§µ‡§§ ‡§ó‡•Ä‡§§‡§æ", text: "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞ ‡§ú‡•ç‡§û‡§æ‡§® ‡§î‡§∞ ‡§µ‡§ø‡§µ‡•á‡§ï ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§∏‡•ã‡§ö-‡§∏‡§Æ‡§ù‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡§´‡§≤‡§§‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§" },
      "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞": { source: "‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•Å‡§∞‡§æ‡§£", text: "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§ó‡•Å‡§∞‡•Å ‡§î‡§∞ ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ú‡•Ä‡§µ‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ ‡§î‡§∞ ‡§∂‡•Å‡§≠ ‡§´‡§≤ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§" },
      "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞": { source: "‡§∂‡•ç‡§∞‡•Ä‡§∏‡•Ç‡§ï‡•ç‡§§", text: "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡§æ‡§§‡§æ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§∞‡§£ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡•å‡§≠‡§æ‡§ó‡•ç‡§Ø ‡§î‡§∞ ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§¨‡§¢‡§º‡§§‡•Ä ‡§π‡•à‡•§" },
      "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞": { source: "‡§∂‡§®‡§ø ‡§∏‡•ç‡§§‡•ã‡§§‡•ç‡§∞", text: "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞ ‡§∏‡§Ç‡§Ø‡§Æ ‡§î‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§∏‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§∂‡§®‡§ø ‡§ï‡•É‡§™‡§æ ‡§¶‡§ø‡§≤‡§æ‡§§‡§æ ‡§π‡•à‡•§" },
      "‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞": { source: "‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§â‡§™‡§æ‡§∏‡§®‡§æ", text: "‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§¨‡§≤ ‡§î‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ ‡§¶‡§ø‡§® ‡§π‡•à ‚Äî ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§ï‡•ã ‡§Ö‡§∞‡•ç‡§ò‡•ç‡§Ø ‡§¶‡•á‡§®‡§æ ‡§§‡•á‡§ú ‡§¨‡§¢‡§º‡§æ‡§§‡§æ ‡§π‡•à‡•§" }
    };
    return map[day] || { source: "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó", text: "‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‚Äî‡§≠‡§ï‡•ç‡§§‡§ø ‡§≠‡§æ‡§µ ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç‡•§" };
  } catch {
    return { source: "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó", text: "‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‚Äî‡§≠‡§ï‡•ç‡§§‡§ø ‡§≠‡§æ‡§µ ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç‡•§" };
  }
}

// ‚úÖ Utility: render into sandesh modal
function renderSandesh({ text, source }) {
  const bodyEl = document.getElementById("sandeshBody");
  const sourceEl = document.getElementById("sandeshSource");
  const modalEl = document.getElementById("sandeshModal");

  if (bodyEl) bodyEl.innerText = text || "‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç";
  if (sourceEl) sourceEl.innerText = source || "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó";
  if (modalEl) modalEl.style.display = "block";

  // share ‡§ï‡•á ‡§≤‡§ø‡§è global
  window._religiousMessage = `üõéÔ∏è ‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂\n\n${text}\n\n‚Äî ${source || "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó"}`;
}

window.openReligiousMessage = async function () {
  try {
    const res = await fetch("https://bhakti-panchang-backend.onrender.com/api/panchang");
    const data = await res.json();

    let rawText = data?.dharmikMessage || "‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç";
    let source = data?.dharmikSource || "‡§≠‡§ï‡•ç‡§§‡§ø ‡§™‡§Ç‡§ö‡§æ‡§Ç‡§ó";

    // üßπ Remove unwanted weekday/tithi words
    const removeWords = [
      "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞","‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞","‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞","‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞","‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞","‡§∂‡§®‡§ø‡§µ‡§æ‡§∞","‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞",
      "‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§¶‡§æ","‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø‡§æ","‡§§‡•É‡§§‡•Ä‡§Ø‡§æ","‡§ö‡§§‡•Å‡§∞‡•ç‡§•‡•Ä","‡§™‡§Ç‡§ö‡§Æ‡•Ä","‡§∑‡§∑‡•ç‡§†‡•Ä","‡§∏‡§™‡•ç‡§§‡§Æ‡•Ä","‡§Ö‡§∑‡•ç‡§ü‡§Æ‡•Ä",
      "‡§®‡§µ‡§Æ‡•Ä","‡§¶‡§∂‡§Æ‡•Ä","‡§è‡§ï‡§æ‡§¶‡§∂‡•Ä","‡§¶‡•ç‡§µ‡§æ‡§¶‡§∂‡•Ä","‡§§‡•ç‡§∞‡§Ø‡•ã‡§¶‡§∂‡•Ä","‡§ö‡§§‡•Å‡§∞‡•ç‡§¶‡§∂‡•Ä","‡§™‡•Ç‡§∞‡•ç‡§£‡§ø‡§Æ‡§æ","‡§Ö‡§Æ‡§æ‡§µ‡§∏‡•ç‡§Ø‡§æ"
    ];
    removeWords.forEach(w => {
      rawText = rawText.replace(new RegExp(w,"g"),"");
    });

    // Split by dash or full stop into sentences
    const parts = rawText.split(/‚Äî|\./).map(s => s.trim()).filter(Boolean);

    // Build HTML with each sentence in its own <p>
    const formatted = parts.map(p => `<p style="font-size:17px;line-height:1.7">${p}</p>`).join("");

    // Render into modal
    document.getElementById("sandeshBody").innerHTML = formatted;
    document.getElementById("sandeshSource").innerText = source;

    // WhatsApp share text (joined sentences)
    const cleanText = parts.join(" | ");
    window._religiousMessage = `üõéÔ∏è ‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂\n\n${cleanText}\n\n‚Äî ${source}`;

    document.getElementById("sandeshModal").style.display = "block";
  } catch (err) {
    console.error("Sandesh load error:", err);
    alert("‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ");
  }
};

// ‚úÖ Share (global)
window.shareSandesh = function () {
  const text = encodeURIComponent(window._religiousMessage || "‡§Ü‡§ú ‡§ï‡§æ ‡§ß‡§æ‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂");
  const waUrl = "https://wa.me/?text=" + text;
  window.open(waUrl, "_blank");
};

// ‚úÖ Close (global)
window.closeSandesh = function () {
  const modalEl = document.getElementById("sandeshModal");
  if (modalEl) modalEl.style.display = "none";
};

</script>

<!-- Audio Katha Modal -->
<div id="audioModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeAudioModal()">√ó</span>
    <h3>üéß ‡§µ‡•ç‡§∞‡§§ ‡§ï‡§•‡§æ‡§è‡§Å (‡§ë‡§°‡§ø‡§Ø‡•ã)</h3>
    <!-- ‡§Ø‡§π‡§æ‡§Å JS ‡§∏‡•á dynamic ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Ü‡§è‡§ó‡•Ä -->
  </div>
</div>

</body>
</html>
